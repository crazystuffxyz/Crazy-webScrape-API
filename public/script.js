document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("search-form"),t=document.getElementById("url-form"),n=document.getElementById("response-output"),o=document.getElementById("loading-bar"),s=document.getElementById("response-time"),a=document.getElementById("response-size");function r(){o&&o.classList.remove("hidden"),n.innerHTML='<code class="language-json">Loading...</code>'}function c(){o&&o.classList.add("hidden")}function i(e){try{return JSON.stringify(e,null,2)}catch(t){return e}}function d(e,t){const n=Date.now()-e,o=new Blob(["string"==typeof t?t:JSON.stringify(t)]).size;s&&(s.textContent=`${n}ms`),a&&(a.textContent=`${o} bytes`)}const l=(e,t="json")=>{const o=n.querySelector("code");o?(o.className=`language-${t}`,o.textContent="json"===t?i(e):e):n.innerHTML="json"===t?`<code class="language-json">${i(e)}</code>`:`<code class="language-${t}">${e}</code>`},u=e=>{const t=n.querySelector("code");t?(t.className="",t.textContent=e):n.innerHTML=`<code>${e}</code>`};e.addEventListener("submit",async function(e){e.preventDefault();const t=Date.now();r();const n=document.getElementById("search-query").value,o=document.getElementById("search-limit").value,s=`/search?q=${encodeURIComponent(n)}&limit=${o}`;try{const e=await fetch(s),n=await e.json();if(!e.ok)throw new Error(n.error||`HTTP error! status: ${e.status}`);c(),l(n),d(t,n)}catch(e){c(),u(`Error: ${e.message}`),d(t,e.message)}}),t.addEventListener("submit",async function(e){e.preventDefault();const t=e.submitter.dataset.action;if(!t)return;const n=Date.now();r();const o=document.getElementById("url-input").value;u(`Fetching from /${t}...`);const s=`/${t}?url=${encodeURIComponent(o)}`,a="article"===t||"citation"===t;try{const e=await fetch(s);if(!e.ok){const t=await e.json();throw new Error(t.error||`HTTP error! status: ${e.status}`)}let o;a?(o=await e.json(),l(o,"json")):(o=await e.text(),l(o,"html"===t?"html":"markdown")),c(),d(n,o)}catch(e){c(),u(`Error: ${e.message}`),d(n,e.message)}}),setInterval(function(){const e=document.querySelector(".particles");if(!e)return;const t=document.createElement("div");t.className="particle",t.style.left=100*Math.random()+"%",t.style.animationDelay=6*Math.random()+"s",e.appendChild(t),setTimeout(()=>{t.parentNode&&t.remove()},6e3)},1e3),document.querySelectorAll(".interactive").forEach(e=>{e.addEventListener("mouseenter",function(){this.style.transform="translateY(-4px) scale(1.02)"}),e.addEventListener("mouseleave",function(){this.style.transform="translateY(0) scale(1)"})})});